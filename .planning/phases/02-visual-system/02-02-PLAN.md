---
phase: 02-visual-system
plan: 02
type: execute
wave: 2
depends_on: ['02-01']
files_modified:
  - src/ui/components/MuscleHeatmap.tsx
  - src/ui/components/TotalVolumeCard.tsx
autonomous: true

must_haves:
  truths:
    - 'Heatmap body regions use centralized color-scale for coloring'
    - 'Muscle cards use centralized color-scale for border/text colors'
    - 'Progress bars use status-success color for goal-met state'
    - 'No inline RGB color values remain in refactored components'
    - 'Visual output matches new color semantics (green at 100%, red only for over)'
  artifacts:
    - path: 'src/ui/components/MuscleHeatmap.tsx'
      provides: 'Refactored heatmap using centralized color-scale'
      imports: ['@core/color-scale']
    - path: 'src/ui/components/TotalVolumeCard.tsx'
      provides: 'Refactored progress bar using CSS tokens'
      contains: 'bg-status-success'
  key_links:
    - from: 'src/ui/components/MuscleHeatmap.tsx'
      to: 'src/core/color-scale.ts'
      via: 'import getVolumeColor'
      pattern: 'import.*getVolumeColor.*@core/color-scale'
    - from: 'src/ui/components/MuscleHeatmap.tsx'
      to: 'getVolumeColor()'
      via: 'function call for body/card colors'
      pattern: "getVolumeColor\\("
---

<objective>
Refactor existing components to use the centralized color system.

Purpose: Replace scattered inline color logic with imports from the new color-scale.ts utility. This ensures visual consistency (VIS-02) and enforces the color semantics where green = goal met and red = warning only (VIS-01).

Output: MuscleHeatmap.tsx and TotalVolumeCard.tsx use centralized color functions. No duplicate color logic remains.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-visual-system/02-CONTEXT.md
@.planning/phases/02-visual-system/02-01-SUMMARY.md

# Files to refactor

@src/ui/components/MuscleHeatmap.tsx
@src/ui/components/TotalVolumeCard.tsx

# New color utility created in Plan 01

@src/core/color-scale.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor MuscleHeatmap to use centralized colors</name>
  <files>src/ui/components/MuscleHeatmap.tsx</files>
  <action>
Refactor MuscleHeatmap.tsx to use the centralized color-scale utility:

**1. Add import at top:**

```typescript
import { getVolumeColor, getVolumeOpacity, getNoTargetColor } from '@core/color-scale';
```

**2. Remove the local `getHeatColor()` function (lines ~168-175):**
Delete this entire function - it's now in color-scale.ts.

**3. Update `highlightedColors` in SplitBodyHighlighter (lines ~596-604):**
Replace the current implementation:

```typescript
const highlightedColors = useMemo(() => {
  return [
    getVolumeColor(12.5), // frequency 1: 0-25%
    getVolumeColor(37.5), // frequency 2: 25-50%
    getVolumeColor(62.5), // frequency 3: 50-75%
    getVolumeColor(87.5), // frequency 4: 75-100%
    getVolumeColor(100), // frequency 5: 100%+
  ];
}, []);
```

**4. Update `MuscleCard` component (lines ~503-516):**
Replace the hardcoded RGB color logic with:

```typescript
// Inside MuscleCard function
const borderColor = getVolumeColor(percentage);
const textColor =
  percentage >= 100
    ? 'text-status-success'
    : percentage >= 75
      ? 'text-amber-400' // Approaching goal
      : percentage >= 50
        ? 'text-teal-400'
        : 'text-blue-400'; // Low volume
```

Note: The existing logic used red for <50% which violates VIS-01. New logic uses the color scale progression - no red below 100%.

**5. Update `bodyColor` in Model component (line ~627):**
Change from hardcoded RGB to:

```typescript
bodyColor={getNoTargetColor()}
```

**6. Leave `getFrequencyLevel()` function as-is:**
This function (lines ~183-190) converts percentage to frequency levels 0-5 for react-body-highlighter. It's not color logic - keep it.

**Key change in semantics:**

- OLD: Red for <50% (wrong - red meant "bad")
- NEW: Red only for >100% (correct - red means "over-target warning")
- Color progression now goes cool -> warm as volume increases
  </action>
  <verify>
  npm run build
  Build succeeds. No TypeScript errors. Import path resolves correctly.
  Manual: Open app, verify heatmap shows colored regions (requires workout data).
  </verify>
  <done>
  MuscleHeatmap.tsx imports from @core/color-scale. Local getHeatColor() removed. highlightedColors uses getVolumeColor. MuscleCard uses color scale for borders. Build passes.
  </done>
  </task>

<task type="auto">
  <name>Task 2: Refactor TotalVolumeCard to use CSS tokens</name>
  <files>src/ui/components/TotalVolumeCard.tsx</files>
  <action>
Refactor TotalVolumeCard.tsx to use the new CSS design tokens:

**1. Update progress bar color (line ~34):**
Change from `bg-accent-orange` to dynamic color based on percentage:

```typescript
// Calculate progress bar color class
const getProgressBarClass = (): string => {
  if (percentage >= 100) return 'bg-status-success'; // Green - goal met
  if (percentage >= 75) return 'bg-amber-500'; // Approaching
  return 'bg-teal-500'; // In progress
};
```

Then use in the progress bar div:

```typescript
<div
  className={`h-full rounded-full transition-all duration-500 ${getProgressBarClass()}`}
  style={{ width: `${percentage}%` }}
/>
```

**2. Update card background (line ~23):**
Optionally update from `bg-primary-700` to `bg-surface-raised`:

```typescript
<div className="rounded-lg bg-surface-raised p-6">
```

This uses the new semantic token instead of primary-700.

**3. Keep existing text colors:**
The existing `text-white` and `text-primary-200` are fine - they work with the dark theme.

**Key behavioral change:**

- OLD: Always orange progress bar (accent-orange)
- NEW: Progress bar color reflects status (teal -> amber -> green)
- This maintains VIS-02 (consistent accent color across components) while adding meaningful color feedback

**Alternative simpler approach:**
If the team prefers consistent orange, just keep `bg-accent-orange`. The requirement VIS-02 says "consistent accent color" which orange satisfies. The above is an enhancement.

Choose the dynamic approach as it provides better user feedback on progress.
</action>
<verify>
npm run build
Build succeeds. No TypeScript errors.
Manual: Open app, view Total Weekly Volume card, verify progress bar renders.
</verify>
<done>
TotalVolumeCard.tsx progress bar uses status-based colors (teal->amber->green). Build passes. Card visually reflects progress state.
</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npm run build` - Production build succeeds
2. `npm run lint` - No lint errors in refactored files
3. Manual verification: Start dev server, view Dashboard
   - Heatmap body regions show colored fills (purple/blue/teal/green gradient)
   - Muscle cards have border colors matching volume percentage
   - TotalVolumeCard progress bar shows appropriate color
4. Verify no hardcoded RGB color strings remain in refactored files
</verification>

<success_criteria>

- [ ] MuscleHeatmap imports from @core/color-scale (VIS-02: consistent color source)
- [ ] No local getHeatColor function in MuscleHeatmap (eliminated duplication)
- [ ] MuscleCard borders use getVolumeColor, no red below 100% (VIS-01)
- [ ] TotalVolumeCard progress bar uses semantic colors
- [ ] Build passes with no errors
- [ ] Lint passes
      </success_criteria>

<output>
After completion, create `.planning/phases/02-visual-system/02-02-SUMMARY.md`
</output>
