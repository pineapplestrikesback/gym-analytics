---
phase: 05-muscle-list
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/ui/components/mobile/MobileMuscleList.tsx
autonomous: true

must_haves:
  truths:
    - "Each muscle shows a horizontal progress bar colored by volume percentage"
    - "Numeric set count appears with secondary emphasis (smaller/dimmer)"
    - "Loading spinner displays while data fetches"
    - "Error state displays when fetch fails"
  artifacts:
    - path: "src/ui/components/mobile/MobileMuscleList.tsx"
      provides: "Complete muscle list with progress bars and data"
      exports: ["MobileMuscleList"]
      min_lines: 120
  key_links:
    - from: "src/ui/components/mobile/MobileMuscleList.tsx"
      to: "@db/hooks"
      via: "useScientificMuscleVolume hook"
      pattern: "useScientificMuscleVolume"
    - from: "src/ui/components/mobile/MobileMuscleList.tsx"
      to: "@core/color-scale"
      via: "getVolumeColor function"
      pattern: "getVolumeColor"
---

<objective>
Add progress bars and data integration to muscle list

Purpose: Wire the collapsible group structure to real volume data using useScientificMuscleVolume hook, displaying each muscle with a colored progress bar and numeric set count.

Output: Fully functional MobileMuscleList showing real workout volume per muscle with visual progress bars.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-muscle-list/05-RESEARCH.md
@.planning/phases/05-muscle-list/05-01-SUMMARY.md

Key patterns:
- useScientificMuscleVolume returns { stats: VolumeStatItem[], isLoading, error }
- VolumeStatItem: { name: string, volume: number, goal: number, percentage: number }
- getVolumeColor(percentage) returns oklch() color string
- TotalVolumeCard: Progress bar pattern (h-2 rounded-full bg-primary-800 container)
- Volume display: volume % 1 === 0 ? volume.toString() : volume.toFixed(1)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire useScientificMuscleVolume hook and add loading/error states</name>
  <files>src/ui/components/mobile/MobileMuscleList.tsx</files>
  <action>
Update MobileMuscleList to fetch real data:

1. Import useScientificMuscleVolume from @db/hooks
2. Import getVolumeColor from @core/color-scale
3. Import type ScientificMuscle from @core/taxonomy
4. Call useScientificMuscleVolume(profileId, daysBack) at component top
5. Create statsMap using useMemo: Map<string, VolumeStatItem> from stats array keyed by name
6. Add loading state (copy pattern from MobileHeatmap.tsx):
   - Centered spinner with animate-spin
   - Return early if isLoading
7. Add error state (copy pattern from MobileHeatmap.tsx):
   - Red background with error message
   - Return early if error
  </action>
  <verify>
- `npm run lint` passes
- Component imports useScientificMuscleVolume and getVolumeColor
- Loading spinner renders when isLoading is true
- Error message renders when error exists
  </verify>
  <done>
Component fetches volume data using the shared hook. Loading spinner shows during fetch. Error state displays on failure.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add muscle row with progress bar</name>
  <files>src/ui/components/mobile/MobileMuscleList.tsx</files>
  <action>
Replace placeholder content with muscle rows:

1. Inside expanded group content, map over group.muscles
2. For each muscle (ScientificMuscle), look up stats from statsMap
3. Render muscle row structure:
   ```
   <div className="flex items-center gap-3 py-2">
     {/* Muscle name - flex-1 for overflow handling */}
     <span className="flex-1 text-sm text-primary-200 truncate">{muscle}</span>

     {/* Progress bar container - fixed width for consistency */}
     <div className="w-24 h-2 overflow-hidden rounded-full bg-primary-800">
       <div
         className="h-full rounded-full transition-all duration-300"
         style={{
           width: `${Math.min(percentage, 100)}%`,
           backgroundColor: getVolumeColor(percentage),
         }}
       />
     </div>

     {/* Numeric value - secondary emphasis (LIST-04) */}
     <span className="w-12 text-right text-xs text-primary-400 font-mono">
       {formatVolume(volume)}
     </span>
   </div>
   ```
4. Create formatVolume helper: volume % 1 === 0 ? volume.toString() : volume.toFixed(1)
5. Handle missing stats (muscle not in statsMap): Show 0 volume, empty progress bar
6. Progress bar width: Use percentage from stats, clamped to 100% (can exceed 100% in data but bar fills at 100%)
7. Progress bar color: getVolumeColor(percentage) - provides dynamic oklch color
  </action>
  <verify>
- `npm run lint` passes
- `npm run build` succeeds
- Each muscle row shows: name, progress bar, numeric value
- Progress bar fill color varies by percentage
- Numeric value uses secondary styling (smaller, dimmer)
  </verify>
  <done>
Each muscle displays name, colored progress bar (0-100% width), and numeric set count with secondary emphasis. Progress bar colors follow the volume color scale (purple -> green -> red).
  </done>
</task>

<task type="auto">
  <name>Task 3: Add group summary in header</name>
  <files>src/ui/components/mobile/MobileMuscleList.tsx</files>
  <action>
Add aggregate stats to group headers (pattern from WeeklyGoalEditor):

1. For each group, calculate:
   - totalVolume: sum of volume for all muscles in group
   - totalGoal: sum of goal for all muscles in group
   - groupPercentage: (totalVolume / totalGoal) * 100 (handle divide by zero)
2. Display in header on the right side:
   ```
   <div className="flex items-center gap-2">
     <span className="font-mono text-sm" style={{ color: getVolumeColor(groupPercentage) }}>
       {formatVolume(totalVolume)}
     </span>
     <span className="text-primary-400 text-xs">sets</span>
   </div>
   ```
3. Group summary color uses getVolumeColor for visual consistency with progress bars
4. Use useMemo for group calculations to avoid recalculating on every render
  </action>
  <verify>
- `npm run lint` passes
- `npm run build` succeeds
- Each group header shows total sets on the right
- Group total color matches the group's overall progress
  </verify>
  <done>
Group headers show aggregate volume with color indicating group completion percentage. Provides at-a-glance group status without expanding.
  </done>
</task>

</tasks>

<verification>
Full integration test:
1. Import MobileMuscleList into a test page or check with dev tools
2. Verify:
   - Data loads from useScientificMuscleVolume
   - All 7 groups render with correct muscles
   - Progress bars fill proportionally with correct colors
   - Numeric values display with proper formatting
   - Group totals appear in headers
   - Expand/collapse still works (from Plan 01)
   - Loading and error states function
</verification>

<success_criteria>
- LIST-01: Muscles grouped by region (7 groups from UI_MUSCLE_GROUPS)
- LIST-02: Groups collapsible (from Plan 01)
- LIST-03: Each muscle shows name + progress bar (percentage-based, dynamic color)
- LIST-04: Numeric value with secondary emphasis (text-xs text-primary-400)
- Data flows from useScientificMuscleVolume hook
- Colors use centralized getVolumeColor from @core/color-scale
- Loading and error states handle edge cases
</success_criteria>

<output>
After completion, create `.planning/phases/05-muscle-list/05-02-SUMMARY.md`
</output>
