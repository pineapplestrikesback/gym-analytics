---
phase: 03-heatmap-core
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/ui/components/mobile/MobileHeatmap.tsx
autonomous: true

must_haves:
  truths:
    - 'Mobile body diagram displays color corresponding to weekly volume'
    - 'Mobile users can visually identify high/low volume muscles at a glance'
    - 'Mobile heatmap uses same color scale as desktop'
  artifacts:
    - path: 'src/ui/components/mobile/MobileHeatmap.tsx'
      provides: 'Mobile-optimized body heatmap'
      exports: ['MobileHeatmap']
  key_links:
    - from: 'MobileHeatmap'
      to: '@core/color-scale'
      via: 'getVolumeColor for body highlighting'
      pattern: "getVolumeColor\\("
    - from: 'MobileHeatmap'
      to: 'react-body-highlighter'
      via: 'Model component for SVG body'
      pattern: "import Model from 'react-body-highlighter'"
---

<objective>
Implement mobile body visualization in MobileHeatmap component (HEAT-02)

Purpose: Provide mobile users with the same color-based training distribution view as desktop.
Output: MobileHeatmap renders a split body view with volume-based coloring optimized for mobile screens.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-heatmap-core/03-RESEARCH.md
@src/ui/components/mobile/MobileHeatmap.tsx
@src/ui/components/MuscleHeatmap.tsx
@src/core/color-scale.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add body visualization to MobileHeatmap</name>
  <files>src/ui/components/mobile/MobileHeatmap.tsx</files>
  <action>
Replace the placeholder shell with actual body visualization:

**Imports to add:**

```typescript
import { useMemo, useId } from 'react';
import Model from 'react-body-highlighter';
import type { IExerciseData, Muscle, IMuscleStats } from 'react-body-highlighter';
import type { ScientificMuscle } from '@core/taxonomy';
import { getVolumeColor, getNoTargetColor } from '@core/color-scale';
```

**Copy from MuscleHeatmap.tsx (reuse existing mappings):**

- `BodyRegion` type
- `REGION_TO_MUSCLES` mapping
- `REGION_TO_LIBRARY_MUSCLES` mapping
- `getFrequencyLevel` function

**Create MobileBodyHighlighter component:**

- Similar to SplitBodyHighlighter from MuscleHeatmap.tsx but without click handlers for now
- Takes `type` (anterior/posterior) and `regionStats` props
- Uses `getVolumeColor()` for highlightedColors array
- Uses `getNoTargetColor()` for bodyColor

**Render split view in MobileHeatmap:**

- Calculate regionStats from stats (same logic as MuscleHeatmap)
- Render front/back halves side by side using overflow clipping technique
- Mobile-specific sizing: smaller max-width, appropriate height for phone screens
- No floating cards, no toggle button - just the colored bodies

**Layout for mobile:**

```tsx
<div className="relative flex justify-center min-h-[400px]">
  {/* Front Half */}
  <div className="w-1/2 overflow-hidden">
    <div className="relative -right-1/2">
      <MobileBodyHighlighter type="anterior" regionStats={regionStats} />
    </div>
  </div>
  {/* Back Half */}
  <div className="w-1/2 overflow-hidden">
    <div className="relative -left-1/2">
      <MobileBodyHighlighter type="posterior" regionStats={regionStats} />
    </div>
  </div>
</div>
```

  </action>
  <verify>
npm run build completes without TypeScript errors.
npm run lint -- src/ui/components/mobile/MobileHeatmap.tsx passes.
Grep for getVolumeColor in MobileHeatmap.tsx returns results.
  </verify>
  <done>
MobileHeatmap renders a split body view with colored muscle regions based on volume data.
  </done>
</task>

<task type="auto">
  <name>Task 2: Optimize mobile layout and styling</name>
  <files>src/ui/components/mobile/MobileHeatmap.tsx</files>
  <action>
Fine-tune the mobile visualization for optimal appearance:

**Container sizing:**

- Set min-height appropriate for mobile (400-450px)
- Ensure bodies fill most of the container width
- Add subtle drop shadow to bodies for depth

**Model styling:**

- Use smaller maxWidth (16rem or similar) to fit mobile screens
- Keep drop-shadow effect for visual polish
- Ensure colors are visible on dark background

**Scoped hover styles (optional but nice):**

- Add subtle hover/active states for muscle regions
- Use useId() for scoped style like in MuscleHeatmap

**Edge case handling:**

- No data: Show "No workout data" message instead of empty bodies
- All zeros: Bodies render with getNoTargetColor() base color

**Remove old placeholder content:**

- Remove the `<div className="rounded-lg bg-primary-800 p-4">` placeholder
- Remove "Mobile visualization coming in Phase 3" text
  </action>
  <verify>
  Open dev server on mobile viewport (iPhone 12 in DevTools: 390x844).
  Body diagram visible and fills most of the screen width.
  Colors render correctly - muscles with volume show color, others gray.
  No horizontal scroll on mobile.
  </verify>
  <done>
  MobileHeatmap is optimized for mobile screens with appropriate sizing and styling. Color is the primary signal for volume distribution.
  </done>
  </task>

</tasks>

<verification>
1. Build: `npm run build` completes without errors
2. Lint: `npm run lint -- src/ui/components/mobile/MobileHeatmap.tsx`
3. Visual (mobile viewport): Body diagram visible, colors correct
4. Grep: `grep -n "getVolumeColor" src/ui/components/mobile/MobileHeatmap.tsx` returns results
</verification>

<success_criteria>

- HEAT-02: Each muscle region displays color corresponding to weekly volume - SATISFIED
- MobileHeatmap renders body diagram (not placeholder text)
- Colors use centralized getVolumeColor from @core/color-scale
- Split view shows front and back body halves
- Layout is mobile-optimized (no horizontal scroll on 390px width)
  </success_criteria>

<output>
After completion, create `.planning/phases/03-heatmap-core/03-02-SUMMARY.md`
</output>
