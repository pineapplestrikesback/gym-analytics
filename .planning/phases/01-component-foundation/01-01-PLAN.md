---
phase: 01-component-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/ui/hooks/useIsMobileDevice.ts
  - src/ui/components/mobile/MobileHeatmap.tsx
  - src/ui/pages/Dashboard.tsx
autonomous: true

must_haves:
  truths:
    - 'Mobile device shows MobileHeatmap component'
    - 'Desktop/tablet device shows existing MuscleHeatmap component'
    - 'MobileHeatmap loads and displays volume data from shared hooks'
    - 'Existing desktop functionality unchanged'
  artifacts:
    - path: 'src/ui/hooks/useIsMobileDevice.ts'
      provides: 'User-agent based device detection'
      exports: ['useIsMobileDevice']
    - path: 'src/ui/components/mobile/MobileHeatmap.tsx'
      provides: 'Mobile-specific heatmap component shell'
      exports: ['MobileHeatmap']
    - path: 'src/ui/pages/Dashboard.tsx'
      provides: 'Conditional rendering based on device type'
      contains: 'isMobile ? <MobileHeatmap'
  key_links:
    - from: 'src/ui/components/mobile/MobileHeatmap.tsx'
      to: '@db/hooks'
      via: 'import useScientificMuscleVolume'
      pattern: 'import.*useScientificMuscleVolume.*from.*@db/hooks'
    - from: 'src/ui/pages/Dashboard.tsx'
      to: 'src/ui/hooks/useIsMobileDevice.ts'
      via: 'import useIsMobileDevice'
      pattern: 'import.*useIsMobileDevice'
    - from: 'src/ui/pages/Dashboard.tsx'
      to: 'src/ui/components/mobile/MobileHeatmap.tsx'
      via: 'import MobileHeatmap'
      pattern: 'import.*MobileHeatmap'
---

<objective>
Create isolated mobile component architecture with shared data hooks.

Purpose: Establish the structural foundation for mobile-specific muscle heatmap that subsequent phases build upon. Mobile and desktop components remain separate, sharing only data hooks (ARCH-01, ARCH-02).

Output:

- Device detection hook (`useIsMobileDevice`)
- Mobile heatmap component shell (`MobileHeatmap`)
- Dashboard conditional rendering
  </objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/01-component-foundation/01-CONTEXT.md
@.planning/phases/01-component-foundation/01-RESEARCH.md

# Key existing files

@src/db/hooks/useVolumeStats.ts
@src/db/hooks/index.ts
@src/ui/pages/Dashboard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create device detection hook</name>
  <files>src/ui/hooks/useIsMobileDevice.ts</files>
  <action>
Create new directory `src/ui/hooks/` and create `useIsMobileDevice.ts`:

1. Export a `useIsMobileDevice()` hook that returns `boolean`
2. Use `useMemo` to compute device type once (stable across renders)
3. Check `navigator.userAgent` against mobile patterns
4. Pattern: `/Android.*Mobile|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i`
5. Note: Deliberately excludes iPad and Android tablets (they get desktop view)
6. Handle SSR case: return `false` if `navigator` is undefined

Follow codebase conventions:

- Explicit return type annotation: `(): boolean`
- JSDoc comment explaining behavior
- No external dependencies (pure native API)

DO NOT:

- Use viewport width detection (causes layout shift)
- Add `react-device-detect` dependency
- Make the hook stateful (no useEffect, no resize listener)
  </action>
  <verify>

1. File exists at `src/ui/hooks/useIsMobileDevice.ts`
2. `npm run lint` passes
3. Exports `useIsMobileDevice` function
   </verify>
   <done>Hook file exists, exports function with correct signature, passes lint</done>
   </task>

<task type="auto">
  <name>Task 2: Create mobile heatmap component shell</name>
  <files>src/ui/components/mobile/MobileHeatmap.tsx</files>
  <action>
Create new directory `src/ui/components/mobile/` and create `MobileHeatmap.tsx`:

1. Interface `MobileHeatmapProps`:
   - `profileId: string | null`
   - `daysBack?: number` (default 7)

2. Export function component `MobileHeatmap`:
   - Call `useScientificMuscleVolume(profileId, daysBack)` from `@db/hooks`
   - Handle loading state: spinner with Tailwind classes matching existing pattern
   - Handle error state: red error card with message
   - Success state: placeholder card showing muscle count (Phase 3 adds visualization)

3. Import types from `@core/taxonomy` if needed for future phases

Match existing codebase patterns:

- Use `React.ReactElement` explicit return type
- Tailwind classes consistent with Dashboard (primary-700 bg, rounded-lg, etc.)
- Loading spinner pattern: `h-8 w-8 animate-spin rounded-full border-4 border-primary-300 border-t-white`

DO NOT:

- Duplicate volume calculation logic (use the hook)
- Add any visualization yet (that's Phase 3)
- Create barrel/index.ts file (not needed yet)
- Copy any code from MuscleHeatmap.tsx (fresh component)
  </action>
  <verify>

1. File exists at `src/ui/components/mobile/MobileHeatmap.tsx`
2. `npm run lint` passes
3. Imports `useScientificMuscleVolume` from `@db/hooks`
4. Exports `MobileHeatmap` component
   </verify>
   <done>Component file exists, imports shared hook (not duplicated), exports component, passes lint</done>
   </task>

<task type="auto">
  <name>Task 3: Update Dashboard for conditional rendering</name>
  <files>src/ui/pages/Dashboard.tsx</files>
  <action>
Modify Dashboard.tsx to conditionally render mobile or desktop heatmap:

1. Add imports at top:
   - `import { useIsMobileDevice } from '@ui/hooks/useIsMobileDevice';`
   - `import { MobileHeatmap } from '@ui/components/mobile/MobileHeatmap';`

2. Inside Dashboard component, add near other hooks:
   - `const isMobile = useIsMobileDevice();`

3. In the "This Week Section" (the div with `rounded-lg bg-primary-700 p-6`), make conditional:
   - If `isMobile`: render `<MobileHeatmap profileId={currentProfile.id} />`
   - If NOT mobile: render existing toggle buttons + `<MuscleHeatmap>`

4. Keep all existing desktop code intact - just wrap in conditional

Structure should be:

```tsx
<div className="rounded-lg bg-primary-700 p-6">
  {isMobile ? (
    <MobileHeatmap profileId={currentProfile.id} />
  ) : (
    <>
      {/* Existing toggle buttons */}
      <div className="mb-6 flex items-center justify-between">
        <h3 className="text-lg font-semibold text-white">This Week</h3>
        {/* Front/Back toggle */}
      </div>
      <MuscleHeatmap profileId={currentProfile.id} view={bodyView} />
    </>
  )}
</div>
```

DO NOT:

- Remove or modify the existing MuscleHeatmap import/usage
- Change the toggle buttons behavior
- Move the bodyView state (keep it - desktop still uses it)
- Touch any code outside the "This Week Section"
  </action>
  <verify>

1. `npm run lint` passes
2. `npm run build` succeeds (no type errors)
3. `npm run dev` - on desktop browser: see existing heatmap with toggle
4. `npm run dev` - in mobile device emulation (Chrome DevTools iPhone): see MobileHeatmap placeholder
   </verify>
   <done>

- Desktop shows existing MuscleHeatmap with front/back toggle
- Mobile shows MobileHeatmap placeholder with "Loaded N muscles"
- No TypeScript errors, build succeeds
  </done>
  </task>

</tasks>

<verification>
After all tasks complete:

1. **Lint/Build check:**

   ```bash
   npm run lint && npm run build
   ```

   Both must pass with no errors.

2. **Desktop verification:**
   - Open http://localhost:3000 in desktop browser
   - See existing muscle heatmap with front/back toggle
   - Toggle works as before (switches body view)

3. **Mobile verification:**
   - Open Chrome DevTools, toggle device toolbar (Ctrl+Shift+M)
   - Select "iPhone 12 Pro" or similar mobile device
   - Refresh page
   - See placeholder card with "Loaded N muscles" (proves data hook works)

4. **Code isolation check (ARCH-01):**

   ```bash
   # Existing MuscleHeatmap should be unchanged
   git diff src/ui/components/MuscleHeatmap.tsx
   ```

   Should show NO changes.

5. **Shared hook check (ARCH-02):**
   ```bash
   grep "useScientificMuscleVolume" src/ui/components/mobile/MobileHeatmap.tsx
   ```
   Should find import from @db/hooks (shared, not duplicated).
   </verification>

<success_criteria>

- [ ] ARCH-01: MobileHeatmap.tsx exists in src/ui/components/mobile/ (separate from desktop)
- [ ] ARCH-02: MobileHeatmap imports useScientificMuscleVolume from @db/hooks (shared, not duplicated)
- [ ] Desktop browser shows existing MuscleHeatmap with working toggle
- [ ] Mobile device emulation shows MobileHeatmap placeholder
- [ ] No TypeScript errors, lint passes, build succeeds
- [ ] Existing MuscleHeatmap.tsx has zero changes (git diff shows nothing)
      </success_criteria>

<output>
After completion, create `.planning/phases/01-component-foundation/01-01-SUMMARY.md`
</output>
