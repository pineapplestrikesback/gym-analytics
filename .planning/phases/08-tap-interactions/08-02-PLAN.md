---
phase: 08-tap-interactions
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/ui/components/mobile/MobileHeatmap.tsx
  - src/index.css
autonomous: false

must_haves:
  truths:
    - "Tapping one side of a bilateral muscle shows animation on BOTH left and right regions"
    - "Animation feedback is brief (100-150ms) and distinct from selection highlight"
    - "No blue tap highlight rectangle appears on mobile"
  artifacts:
    - path: "src/ui/components/mobile/MobileHeatmap.tsx"
      provides: "Bilateral tap animation via tappedRegion state"
      contains: "tappedRegion"
  key_links:
    - from: "handleMuscleClick"
      to: "exerciseData memo"
      via: "tappedRegion triggers frequency 7 on both views"
      pattern: "tappedRegion.*frequency.*7"
---

<objective>
Fix bilateral tap animation feedback on heatmap and suppress default mobile tap highlights.

Purpose: When tapping a muscle, both left and right sides should show the same visual feedback, making the bilateral connection obvious (HEAT-04 polish).
Output: Consistent bilateral animation on heatmap taps, clean tap experience without blue rectangles.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/ui/components/mobile/MobileHeatmap.tsx
@src/index.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add bilateral tap animation to MobileHeatmap</name>
  <files>src/ui/components/mobile/MobileHeatmap.tsx</files>
  <action>
Add state-based tap animation that affects both front and back SVG regions simultaneously:

1. Add new state for tap animation:
   ```typescript
   const [tappedRegion, setTappedRegion] = useState<BodyRegion | null>(null);
   ```

2. Add a 7th color to HIGHLIGHTED_COLORS array for tap animation (white flash):
   ```typescript
   const HIGHLIGHTED_COLORS = [
     getVolumeColor(12.5),   // frequency 1: 0-25%
     getVolumeColor(37.5),   // frequency 2: 25-50%
     getVolumeColor(62.5),   // frequency 3: 50-75%
     getVolumeColor(87.5),   // frequency 4: 75-100%
     getVolumeColor(100),    // frequency 5: 100%+
     'rgb(245, 158, 11)',    // frequency 6: selected state (amber)
     'rgb(255, 255, 255)',   // frequency 7: tap animation (white flash)
   ];
   ```

3. Pass tappedRegion to MobileBodyHighlighter component:
   ```typescript
   <MobileBodyHighlighter
     type="anterior"
     regionStats={regionStats}
     selectedRegion={selectedRegion}
     tappedRegion={tappedRegion}
     onRegionClick={...}
   />
   ```

4. Update MobileBodyHighlighter props interface and exerciseData memo:
   ```typescript
   // In exerciseData memo, prioritize tap animation over selection:
   const frequency = tappedRegion === region
     ? 7  // Tap animation (highest priority)
     : selectedRegion === region
       ? 6  // Selected state
       : getFrequencyLevel(stats.percentage);
   ```

5. Update handleMuscleClick in MobileBodyHighlighter to trigger bilateral animation:
   ```typescript
   const handleMuscleClick = useCallback(
     (stats: { muscle: string; data: { exercises: string[]; frequency: number } }) => {
       const region = stats.data?.exercises?.[0] as BodyRegion;
       if (!region) {
         const mappedRegion = muscleToRegion.get(stats.muscle);
         if (mappedRegion) {
           // Trigger bilateral tap animation
           setTappedRegion(mappedRegion);
           setTimeout(() => setTappedRegion(null), 150);
           onRegionClick(selectedRegion === mappedRegion ? null : mappedRegion);
         }
         return;
       }

       // Trigger bilateral tap animation
       setTappedRegion(region);
       setTimeout(() => setTappedRegion(null), 150);

       onRegionClick(selectedRegion === region ? null : region);
     },
     [muscleToRegion, onRegionClick, selectedRegion]
   );
   ```

   Note: setTappedRegion needs to be passed down from parent, OR lift handleMuscleClick to parent component since it needs to set parent state.

   Simpler approach: Pass setTappedRegion as a prop to MobileBodyHighlighter, similar to onRegionClick.
  </action>
  <verify>npm run build succeeds. Test on mobile: tap one side of a muscle and observe both sides flash white briefly.</verify>
  <done>Bilateral muscles show synchronized tap animation feedback on both left and right SVG regions.</done>
</task>

<task type="auto">
  <name>Task 2: Suppress default tap highlight color</name>
  <files>src/index.css</files>
  <action>
Add CSS to suppress the default blue tap highlight rectangle on iOS/Android:

Add to index.css after the @theme block:

```css
@layer base {
  html {
    -webkit-tap-highlight-color: transparent;
  }
}
```

This prevents the blue flash that can appear when tapping interactive elements on mobile Safari and Chrome for Android.
  </action>
  <verify>Build passes. On mobile, tapping buttons and interactive elements shows no blue rectangle overlay.</verify>
  <done>Mobile tap interactions have no default browser highlight interference.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    - Bilateral tap animation: tapping one side of a muscle (e.g., left bicep) briefly flashes BOTH left and right bicep white
    - Clean tap experience: no blue highlight rectangle appears on any taps
    - List row taps: muscle rows in list view open modal (from 08-01)
  </what-built>
  <how-to-verify>
    1. Open http://localhost:3000 on a mobile device (or mobile emulator)
    2. Navigate to Dashboard (should show mobile heatmap on phone)

    **Test bilateral animation:**
    3. Tap the left bicep region on the body
    4. Observe: BOTH left and right bicep should flash white briefly (150ms)
    5. After flash, both biceps should show amber selection highlight
    6. Tap the right quad - both quads should flash, then highlight

    **Test tap highlight suppression:**
    7. Tap various buttons (Front/Back toggle, carousel dots)
    8. Observe: NO blue rectangle should appear during taps

    **Test list row taps (from 08-01):**
    9. Swipe to muscle list view
    10. Tap any muscle row (e.g., "Latissimus Dorsi")
    11. Observe: Row shows brief highlight, modal opens with that muscle's stats
    12. Tap group header (e.g., "Back")
    13. Observe: Group expands/collapses, NO modal opens
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues with tap feedback</resume-signal>
</task>

</tasks>

<verification>
- [ ] `npm run build` passes
- [ ] Bilateral tap animation works on heatmap (both sides flash)
- [ ] No blue tap highlight on any interactive elements
- [ ] All tap interactions feel responsive and native
</verification>

<success_criteria>
HEAT-04 requirement polished: Bilateral muscles show connected feedback on tap.
Phase 8 complete: All tap interactions work correctly on both heatmap and list views.
</success_criteria>

<output>
After completion, create `.planning/phases/08-tap-interactions/08-02-SUMMARY.md`
</output>
